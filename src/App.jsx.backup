import React, { useState, useMemo, useRef } from 'react';
import { Calculator, FileText, Settings, Search, Save, Download, Printer, X, Edit3, ChevronRight, CheckCircle, Lightbulb, Zap, Mail, TrendingDown, RefreshCw, UserPlus, Users, MapPin, Percent } from 'lucide-react';
import html2pdf from 'html2pdf.js';
import { asBlob } from 'html-docx-js/dist/html-docx';
import { saveAs } from 'file-saver';

// EMO 2026 BÃ¶lgesel Azaltma KatsayÄ±larÄ± Listesi (Sabit Veri)
const REGION_LIST = [
  { name: "Adana (Merkez)", coeff: 1.00 },
  { name: "Adana (Ã‡evre Ä°lÃ§eler)", coeff: 0.75 },
  { name: "AdÄ±yaman", coeff: 0.75 },
  { name: "Afyon", coeff: 0.60 },
  { name: "AÄŸrÄ±", coeff: 0.75 },
  { name: "Aksaray", coeff: 0.60 },
  { name: "Amasya", coeff: 0.75 },
  { name: "Ankara (BÃ¼yÃ¼kÅŸehir)", coeff: 1.00 },
  { name: "Antalya (Merkez)", coeff: 1.00 },
  { name: "Alanya", coeff: 1.00 },
  { name: "Artvin", coeff: 0.75 },
  { name: "AydÄ±n (Merkez)", coeff: 1.00 },
  { name: "AydÄ±n (DiÄŸer Ä°lÃ§eler)", coeff: 0.75 },
  { name: "BalÄ±kesir", coeff: 0.75 },
  { name: "BartÄ±n", coeff: 0.75 },
  { name: "Batman", coeff: 0.75 },
  { name: "Bayburt", coeff: 0.75 },
  { name: "Bilecik", coeff: 0.75 },
  { name: "BingÃ¶l", coeff: 0.75 },
  { name: "Bitlis", coeff: 0.75 },
  { name: "Bolu", coeff: 0.75 },
  { name: "Burdur", coeff: 0.75 },
  { name: "Bursa (Merkez)", coeff: 1.00 },
  { name: "Ã‡anakkale", coeff: 0.75 },
  { name: "Ã‡ankÄ±rÄ±", coeff: 0.60 },
  { name: "Ã‡orum", coeff: 0.75 },
  { name: "Denizli (Merkez)", coeff: 1.00 },
  { name: "DiyarbakÄ±r (Merkez)", coeff: 1.00 },
  { name: "DÃ¼zce", coeff: 0.75 },
  { name: "ElazÄ±ÄŸ", coeff: 0.75 },
  { name: "Erzincan", coeff: 0.60 },
  { name: "Erzurum (BÃ¼yÃ¼kÅŸehir)", coeff: 0.75 },
  { name: "EskiÅŸehir (Merkez)", coeff: 1.00 },
  { name: "Gaziantep (Merkez)", coeff: 1.00 },
  { name: "Giresun", coeff: 0.75 },
  { name: "GÃ¼mÃ¼ÅŸhane", coeff: 0.75 },
  { name: "Hakkari", coeff: 0.75 },
  { name: "Hatay", coeff: 1.00 },
  { name: "IÄŸdÄ±r", coeff: 0.75 },
  { name: "Isparta", coeff: 1.00 },
  { name: "Ä°stanbul", coeff: 1.00 },
  { name: "Ä°zmir (Merkez Ä°lÃ§eler)", coeff: 1.00 },
  { name: "Ä°zmir (AliaÄŸa/KemalpaÅŸa/Ã–demiÅŸ)", coeff: 1.00 },
  { name: "Ä°zmir (DiÄŸer Ä°lÃ§eler)", coeff: 0.75 },
  { name: "K.MaraÅŸ", coeff: 0.75 },
  { name: "KarabÃ¼k", coeff: 0.75 },
  { name: "Karaman", coeff: 0.75 },
  { name: "Kars", coeff: 0.75 },
  { name: "Kastamonu", coeff: 0.60 },
  { name: "Kayseri (BÃ¼yÃ¼kÅŸehir)", coeff: 0.75 },
  { name: "KÄ±rÄ±kkale", coeff: 0.60 },
  { name: "KÄ±rÅŸehir", coeff: 0.60 },
  { name: "Kilis", coeff: 0.75 },
  { name: "Kocaeli (Merkez)", coeff: 1.00 },
  { name: "Konya (BÃ¼yÃ¼kÅŸehir)", coeff: 0.75 },
  { name: "KÃ¼tahya", coeff: 0.75 },
  { name: "Malatya", coeff: 0.75 },
  { name: "Manisa (Merkez/Akhisar)", coeff: 1.00 },
  { name: "Manisa (DiÄŸer Ä°lÃ§eler)", coeff: 0.75 },
  { name: "Mardin", coeff: 0.75 },
  { name: "Mersin (Merkez)", coeff: 1.00 },
  { name: "MuÄŸla", coeff: 1.00 },
  { name: "MuÅŸ", coeff: 0.75 },
  { name: "NevÅŸehir", coeff: 0.60 },
  { name: "NiÄŸde", coeff: 0.75 },
  { name: "Ordu", coeff: 0.75 },
  { name: "Osmaniye", coeff: 0.75 },
  { name: "Rize", coeff: 0.75 },
  { name: "Sakarya", coeff: 0.75 },
  { name: "Samsun (Merkez)", coeff: 1.00 },
  { name: "Siirt", coeff: 0.75 },
  { name: "Sinop", coeff: 0.75 },
  { name: "Sivas", coeff: 0.60 },
  { name: "ÅžanlÄ±urfa", coeff: 0.75 },
  { name: "ÅžÄ±rnak", coeff: 0.75 },
  { name: "TekirdaÄŸ (Trakya)", coeff: 0.75 },
  { name: "Tokat", coeff: 0.60 },
  { name: "Trabzon (Merkez)", coeff: 1.00 },
  { name: "Trabzon (Ä°lÃ§eler)", coeff: 0.75 },
  { name: "Tunceli", coeff: 0.75 },
  { name: "UÅŸak (Merkez)", coeff: 1.00 },
  { name: "Van", coeff: 0.75 },
  { name: "Yalova", coeff: 0.75 },
  { name: "Yozgat", coeff: 0.60 },
  { name: "Zonguldak", coeff: 0.75 },
  { name: "DiÄŸer (VarsayÄ±lan)", coeff: 1.00 }
];

const App = () => {
  // --- State Definitions ---
  const [activeTab, setActiveTab] = useState('manual');
  const [selectedCompany, setSelectedCompany] = useState(null);
  
  const [isSettingsOpen, setIsSettingsOpen] = useState(false);
  const [llmOutput, setLlmOutput] = useState(null);
  const [llmLoading, setLlmLoading] = useState(false);
  const [llmFeature, setLlmFeature] = useState(null); 

  const apiKey = ""; // API key environment tarafÄ±ndan saÄŸlanÄ±r
  
  const proposalRef = useRef(null); // PDF/Word export iÃ§in referans

  // Manuel GiriÅŸ Form State
  const [manualForm, setManualForm] = useState({
    name: '',
    sector: '',
    contactName: '',
    powerStr: '',
    type: 'bina', // 'bina' or 'direk'
    region: 'Ä°zmir (KemalpaÅŸa)', // VarsayÄ±lan gÃ¶rÃ¼ntÃ¼lenen isim
    regionCoeff: 1.00, // VarsayÄ±lan katsayÄ±
    customDiscount: 70 // KullanÄ±cÄ±ya Ã¶zel iskonto
  });

  // Default Parameters (EMO 2026)
  const [params, setParams] = useState({
    baseFee: 8802.00,        // 400 kVA (2 hÃ¼cre) Sabit
    rate1: 5.34,             // 401-5000 kVA birim fiyat
    rate2: 4.10,             // >5000 kVA birim fiyat
    
    // Direk Tipi / KÃ¼Ã§Ã¼k GÃ¼Ã§ler (EMO 2026 KÄ±sÄ±m III - Madde 3.1)
    poleFee1: 3887.00,       // 0-50 kVA
    poleFee2: 4921.00,       // 51-160 kVA
    poleFee3: 6770.00,       // 161-400 kVA

    discountRate: 70,        // % (VarsayÄ±lan)
    regionCoeff: 1.00,       // BÃ¶lge KatsayÄ±sÄ± (BK) (VarsayÄ±lan)
    year: 2026
  });

  // --- Helpers ---

  // Helper to parse power string "2000+2000+1600" -> 5600
  const parsePower = (str) => {
    if (!str) return 0;
    return str.toString().split('+').reduce((acc, curr) => acc + parseInt(curr.trim() || 0), 0);
  };

  const formatCurrency = (val) => {
    if (val === null || val === undefined || isNaN(val)) return "0,00 TL";
    if (val < 100) return new Intl.NumberFormat('tr-TR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(val);
    return new Intl.NumberFormat('tr-TR', { style: 'currency', currency: 'TRY' }).format(val);
  };
  
  const formatNumber = (val) => {
    if (val === null || val === undefined || isNaN(val)) return "0";
    return new Intl.NumberFormat('tr-TR').format(val);
  };

  // Helper to calculate fees for a single company object
  const calculateCompanyFees = (companyData) => {
      const totalKVA = parsePower(companyData.powerStr);
      let nominalFee = 0;
      
      // EMO 2026 Hesaplama MantÄ±ÄŸÄ±
      if (companyData.type === 'direk' || (totalKVA < 400 && companyData.type !== 'bina')) {
          // Direk Tipi Trafo Merkezleri (EMO 2026 KÄ±sÄ±m III - Madde 3.1)
          if (totalKVA <= 50) {
              nominalFee = params.poleFee1;
          } else if (totalKVA <= 160) {
              nominalFee = params.poleFee2;
          } else if (totalKVA <= 400) {
              nominalFee = params.poleFee3;
          } else {
              // 400 kVA Ã¼zeri direk tipi EMO listesinde net deÄŸilse bina tipi baz alÄ±nÄ±r
              nominalFee = params.baseFee + ((totalKVA - 400) * params.rate1);
          }
      } else {
          // Bina Tipi Trafo Merkezleri (EMO 2026 - KÄ±sÄ±m III - Madde 5.2)
          if (totalKVA <= 400) {
             // Madde 5.2.1: Ä°lk 400 kVA (2 hÃ¼cre)
             nominalFee = params.baseFee;
          } else if (totalKVA <= 5000) {
             // Madde 5.2.2: 401 kVA - 5 MVA arasÄ± artan her kVA iÃ§in
             nominalFee = params.baseFee + ((totalKVA - 400) * params.rate1);
          } else {
             // Madde 5.2.3: 5 MVA Ã¼zeri artan her kVA iÃ§in
             // Ä°lk 400 sabit + (4600 * rate1) + (kalan * rate2)
             nominalFee = params.baseFee + (4600 * params.rate1) + ((totalKVA - 5000) * params.rate2);
          }
      }

      // BÃ¶lge KatsayÄ±sÄ± UygulamasÄ±
      const appliedRegionCoeff = companyData.regionCoeff !== undefined ? companyData.regionCoeff : params.regionCoeff;
      nominalFee = nominalFee * appliedRegionCoeff;

      // Ä°skonto UygulamasÄ±
      const appliedDiscountRate = companyData.discountRate !== undefined ? companyData.discountRate : params.discountRate;

      const discountAmount = nominalFee * (appliedDiscountRate / 100);
      const offerPrice = nominalFee - discountAmount;

      return {
        ...companyData,
        totalKVA,
        nominalFee,
        discountAmount,
        offerPrice,
        regionCoeff: appliedRegionCoeff,
        appliedDiscountRate
      };
  };

  // --- Handlers ---
  const generateProposal = (company) => {
    setSelectedCompany(company);
    setLlmOutput(null); 
    setLlmFeature(null);
    setActiveTab('proposal');
  };DownloadPDF = async () => {
    if (!proposalRef.current || !selectedCompany) return;
    
    const element = proposalRef.current;
    const fileName = `YG_Teklif_${selectedCompany.name.replace(/\s+/g, '_')}_${new Date().toLocaleDateString('tr-TR').replace(/\./g, '-')}.pdf`;
    
    const opt = {
      margin: 0,
      filename: fileName,
      image: { type: 'jpeg', quality: 0.98 },
      html2canvas: { 
        scale: 2,
        useCORS: true,
        letterRendering: true
      },
      jsPDF: { 
        unit: 'mm', 
        format: 'a4', 
        orientation: 'portrait' 
      }
    };

    try {
      await html2pdf().set(opt).from(element).save();
    } catch (error) {
      console.error('PDF oluÅŸturma hatasÄ±:', error);
      alert('PDF oluÅŸturulurken bir hata oluÅŸtu. LÃ¼tfen tekrar deneyin.');
    }
  };

  const handleDownloadWord = async () => {
    if (!proposalRef.current || !selectedCompany) return;
    
    try {
      const element = proposalRef.current;
      const fileName = `YG_Teklif_${selectedCompany.name.replace(/\s+/g, '_')}_${new Date().toLocaleDateString('tr-TR').replace(/\./g, '-')}.docx`;
      
      // HTML'i klonla ve temizle
      const clonedElement = element.cloneNode(true);
      
      // Inline stilleri ekle
      const styleString = `
        <style>
          body { font-family: 'Calibri', 'Arial', sans-serif; font-size: 11pt; line-height: 1.5; }
          h1 { font-size: 18pt; font-weight: bold; color: #1e3a8a; }
          h2, h3 { font-size: 14pt; font-weight: bold; color: #1e40af; margin-top: 12pt; }
          table { border-collapse: collapse; width: 100%; margin: 10pt 0; }
          th, td { border: 1px solid #666; padding: 8pt; text-align: left; }
          th { background-color: #f3f4f6; font-weight: bold; }
          ul { margin: 5pt 0; padding-left: 20pt; }
          li { margin: 3pt 0; }
          .highlight { background-color: #1e3a8a; color: white; padding: 15pt; border-radius: 5pt; }
        </style>
      `;
      
      const htmlContent = styleString + clonedElement.innerHTML;
      
      const blob = await asBlob(htmlContent);
      saveAs(blob, fileName);
    } catch (error) {
      console.error('Word belgesi oluÅŸturma hatasÄ±:', error);
      alert('Word belgesi oluÅŸturulurken bir hata oluÅŸtu. LÃ¼tfen tekrar deneyin.');
    }
  const handlePrint = () => {
    window.print();
  };

  const handleManualSubmit = (e) => {
    e.preventDefault();
    const manualCompany = {
        id: '', // Manuel iÃ§in boÅŸ bÄ±rakabiliriz
        name: manualForm.name,
        sector: manualForm.sector,
        powerStr: manualForm.powerStr,
        contactName: manualForm.contactName,
        type: manualForm.type,
        regionCoeff: manualForm.regionCoeff, // Manuel formdan gelen Ã¶zel katsayÄ±
        discountRate: manualForm.customDiscount // Manuel formdan gelen Ã¶zel iskonto
    };
    const calculated = calculateCompanyFees(manualCompany);
    generateProposal(calculated);
  };

  const handleRegionChange = (e) => {
    const selectedRegionName = e.target.value;
    const selectedRegion = REGION_LIST.find(r => r.name === selectedRegionName);
    if (selectedRegion) {
        setManualForm({
            ...manualForm,
            region: selectedRegionName,
            regionCoeff: selectedRegion.coeff
        });
    }
  };

  // --- Gemini API Call Function ---
  const callGeminiApi = async (prompt, maxRetries = 5) => {
    setLlmLoading(true);
    setLlmOutput(null);

    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

    const systemInstruction = {
        parts: [{ 
            text: "Sen, YÃ¼ksek Gerilim Ä°ÅŸletme SorumluluÄŸu teklifleri hazÄ±rlayan bir enerji firmasÄ±nÄ±n deneyimli SatÄ±ÅŸ ve Pazarlama YÃ¶neticisisin. CevaplarÄ±nÄ± her zaman TÃ¼rkÃ§e, profesyonel, Ã¶zgÃ¼venli ve ikna edici bir dille, Markdown formatÄ±nda (BaÅŸlÄ±klar, kalÄ±nlaÅŸtÄ±rmalar, listeler kullanarak) ve kÄ±sa tutarak oluÅŸtur. Kesinlikle EMO rakamlarÄ±nÄ± veya TL cinsinden fiyatlarÄ± metin iÃ§inde tekrar etme. FiyatlarÄ±n rekabetÃ§i olduÄŸunu vurgula. Cevap, sadece talep edilen analiz veya metin olmalÄ±dÄ±r, baÅŸka bir konuÅŸma veya aÃ§Ä±klama iÃ§ermemelidir." 
        }]
    };

    const payload = {
      contents: [{ parts: [{ text: prompt }] }],
      systemInstruction: systemInstruction,
      config: {
        temperature: 0.7
      }
    };

    for (let attempt = 0; attempt < maxRetries; attempt++) {
      try {
        const response = await fetch(apiUrl, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        if (response.status === 429 && attempt < maxRetries - 1) {
          const delay = Math.pow(2, attempt) * 1000 + Math.random() * 1000;
          await new Promise(resolve => setTimeout(resolve, delay));
          continue;
        }

        if (!response.ok) {
          throw new Error(`API error: ${response.statusText}`);
        }

        const result = await response.json();
        const text = result.candidates?.[0]?.content?.parts?.[0]?.text || "Gemini'den yanÄ±t alÄ±namadÄ±.";
        setLlmLoading(false);
        return text;

      } catch (error) {
        console.error(`Gemini API Ã§aÄŸrÄ±sÄ± baÅŸarÄ±sÄ±z oldu (Deneme ${attempt + 1}):`, error);
        if (attempt === maxRetries - 1) {
          setLlmLoading(false);
          return "API Ã§aÄŸrÄ±sÄ±nda kritik bir hata oluÅŸtu. LÃ¼tfen daha sonra tekrar deneyin.";
        }
        const delay = Math.pow(2, attempt) * 1000 + Math.random() * 1000;
        await new Promise(resolve => setTimeout(resolve, delay));
      }
    }
  };

  const handleGenerateSummary = async (company) => {
    setLlmFeature('summary');
    const prompt = `
      "${company.name}" (Yetkili: ${company.contactName || 'BelirtilmemiÅŸ'}) iÃ§in YG Ä°ÅŸletme SorumluluÄŸu hizmeti teklifi hazÄ±rladÄ±m.
      Tesisin SektÃ¶rÃ¼: ${company.sector}.
      Toplam Kurulu GÃ¼Ã§: ${company.totalKVA} kVA.
      Tesis Tipi: ${company.type === 'direk' ? 'Direk Tipi' : 'Bina Tipi'}.
      EMO Nominal Ãœcret: ${company.nominalFee} TL.
      Uygulanan Ä°skonto OranÄ±: %${company.appliedDiscountRate || params.discountRate}.
      Nihai Teklif FiyatÄ± (AylÄ±k): ${company.offerPrice} TL (KDV hariÃ§).

      Bu bilgileri kullanarak, teklifi sunmak Ã¼zere profesyonel ve kÄ±sa bir e-posta gÃ¶vdesi (sadece iÃ§erik, hitap ve imza hariÃ§) oluÅŸtur. Metinde, teklifin uygun maliyetli olduÄŸunu ve iÅŸletme sÃ¼rekliliÄŸi iÃ§in ne kadar Ã¶nemli olduÄŸunu vurgula.
    `;
    const result = await callGeminiApi(prompt);
    setLlmOutput(result);
  };

  const handleGenerateAnalysis = async (company) => {
    setLlmFeature('analysis');
    const prompt = `
      "${company.name}" iÃ§in YG Ä°ÅŸletme SorumluluÄŸu hizmeti teklifi hazÄ±rladÄ±m.
      Tesisin SektÃ¶rÃ¼: ${company.sector}.
      Toplam Kurulu GÃ¼Ã§: ${company.totalKVA} kVA.
      EMO Nominal Ãœcret: ${company.nominalFee} TL.
      Nihai Teklif FiyatÄ± (AylÄ±k): ${company.offerPrice} TL (KDV hariÃ§).

      Bu tesis iÃ§in, sektÃ¶r ve kurulu gÃ¼ce gÃ¶re piyasa fiyat ortalamalarÄ±na ve diÄŸer firmalarÄ±n rekabet dÃ¼zeyine dair bir "RekabetÃ§i KonumlandÄ±rma Analizi" metni oluÅŸtur. Bu metin, teklifimizin rekabetÃ§iliÄŸini ve firmanÄ±n kritik enerji altyapÄ± ihtiyaÃ§larÄ±na nasÄ±l yanÄ±t verdiÄŸini vurgulamalÄ±dÄ±r. SektÃ¶rdeki olasÄ± fiyat dalgalanmalarÄ±na karÅŸÄ± gÃ¼vencemizi belirt.
    `;
    const result = await callGeminiApi(prompt);
    setLlmOutput(result);
  };

  // --- UI Components ---
  const LLMOutputDisplay = ({ output, loading, feature, onRegenerate }) => {
    if (!feature) return null;

    const titleMap = {
      summary: "âœ¨ Teklif Sunum Ã–zeti (E-posta Ä°Ã§in)",
      analysis: "âœ¨ RekabetÃ§i KonumlandÄ±rma Analizi"
    };

    return (
      <div className="bg-white p-6 rounded-xl shadow-lg border border-gray-200">
        <h3 className="font-bold text-lg mb-4 flex items-center justify-between text-blue-900">
          {titleMap[feature]}
          <button 
            onClick={onRegenerate}
            className="text-xs text-gray-500 hover:text-blue-600 flex items-center transition"
            disabled={loading}
            title="Tekrar OluÅŸtur"
          >
             <RefreshCw className={`w-3 h-3 mr-1 ${loading ? 'animate-spin' : ''}`} />
             Yenile
          </button>
        </h3>

        {loading ? (
          <div className="text-center py-8 text-blue-500 flex flex-col items-center">
            <svg className="animate-spin h-5 w-5 text-blue-500 mb-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
              <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <p>Gemini analiz ediyor ve metni oluÅŸturuyor...</p>
          </div>
        ) : (
          <div className="prose max-w-none text-gray-700 leading-normal">
            <pre className="whitespace-pre-wrap font-sans bg-gray-50 p-4 rounded-lg border text-sm">
                {output}
            </pre>
          </div>
        )}
      </div>
    );
  };

  return (
    <div className="min-h-screen bg-gray-50 text-gray-800 font-sans">
      
      {/* Header */}
      <header className="bg-blue-900 text-white shadow-lg">
        <div className="container mx-auto px-6 py-4 flex justify-between items-center">
          <div className="flex items-center space-x-3">
            <Calculator className="h-8 w-8 text-yellow-400" />
            <div>
              <h1 className="text-xl font-bold">YG Ä°ÅŸletme SorumluluÄŸu</h1>
              <p className="text-xs text-blue-200">Teklif HazÄ±rlama Otomasyonu v2026</p>
            </div>
          </div>
          <button 
            onClick={() => setIsSettingsOpen(!isSettingsOpen)}
            className="flex items-center space-x-2 bg-blue-800 hover:bg-blue-700 px-4 py-2 rounded-lg transition"
          >
            <Settings className="h-4 w-4" />
            <span>Parametreler</span>
          </button>
        </div>
      </header>

      {/* Settings Panel (Collapsible) */}
      {isSettingsOpen && (
        <div className="bg-white border-b border-gray-200 shadow-inner">
          <div className="container mx-auto px-6 py-6">
            <h3 className="font-semibold text-gray-700 mb-4 flex items-center">
              <Edit3 className="h-4 w-4 mr-2" />
              Hesaplama Parametreleri (EMO 2026)
            </h3>
            <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
              <div>
                <label className="block text-sm font-medium text-gray-600 mb-1">Sabit Ãœcret (Bina 0-400)</label>
                <div className="relative">
                  <input 
                    type="number" 
                    value={params.baseFee} 
                    onChange={(e) => setParams({...params, baseFee: parseFloat(e.target.value) || 0})}
                    className="w-full border rounded px-3 py-2 focus:ring-2 focus:ring-blue-500 outline-none" 
                  />
                  <span className="absolute right-3 top-2 text-gray-400 text-sm">TL</span>
                </div>
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-600 mb-1">Birim Fiyat (401-5000)</label>
                <div className="relative">
                  <input 
                    type="number" 
                    value={params.rate1} 
                    onChange={(e) => setParams({...params, rate1: parseFloat(e.target.value) || 0})}
                    className="w-full border rounded px-3 py-2 focus:ring-2 focus:ring-blue-500 outline-none" 
                  />
                  <span className="absolute right-3 top-2 text-gray-400 text-sm">TL/kVA</span>
                </div>
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-600 mb-1">Birim Fiyat (&gt;5000 kVA)</label>
                <div className="relative">
                  <input 
                    type="number" 
                    value={params.rate2} 
                    onChange={(e) => setParams({...params, rate2: parseFloat(e.target.value) || 0})}
                    className="w-full border rounded px-3 py-2 focus:ring-2 focus:ring-blue-500 outline-none" 
                  />
                  <span className="absolute right-3 top-2 text-gray-400 text-sm">TL/kVA</span>
                </div>
              </div>
               <div>
                <label className="block text-sm font-medium text-gray-600 mb-1">Global BÃ¶lge KatsayÄ±sÄ± (BK)</label>
                <div className="relative">
                  <input 
                    type="number"
                    step="0.05"
                    value={params.regionCoeff} 
                    onChange={(e) => setParams({...params, regionCoeff: parseFloat(e.target.value) || 1.0})}
                    className="w-full border rounded px-3 py-2 focus:ring-2 focus:ring-blue-500 outline-none" 
                  />
                  <span className="absolute right-3 top-2 text-gray-400 text-sm">x</span>
                </div>
                <p className="text-xs text-gray-400 mt-1">Ã–rn: Ä°zmir: 1.00, Adana: 0.75 (Liste dÄ±ÅŸÄ± iÃ§in)</p>
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-600 mb-1">Global Ä°skonto</label>
                <div className="relative">
                  <input 
                    type="number" 
                    value={params.discountRate} 
                    onChange={(e) => setParams({...params, discountRate: parseFloat(e.target.value) || 0})}
                    className="w-full border rounded px-3 py-2 focus:ring-2 focus:ring-blue-500 outline-none text-blue-700 font-bold" 
                  />
                  <span className="absolute right-3 top-2 text-gray-400 text-sm">%</span>
                </div>
              </div>
              {/* Direk Tipi AyarlarÄ± */}
              <div className="md:col-span-3 border-t pt-4 mt-2">
                 <p className="text-xs font-bold text-gray-500 mb-2">DÄ°REK TÄ°PÄ° TRAFOLAR (EMO Madde 3.1)</p>
                 <div className="grid grid-cols-3 gap-4">
                    <div>
                        <label className="text-xs text-gray-500">0-50 kVA</label>
                        <input type="number" value={params.poleFee1} onChange={(e) => setParams({...params, poleFee1: parseFloat(e.target.value) || 0})} className="w-full border p-1 rounded text-xs" />
                    </div>
                    <div>
                        <label className="text-xs text-gray-500">51-160 kVA</label>
                        <input type="number" value={params.poleFee2} onChange={(e) => setParams({...params, poleFee2: parseFloat(e.target.value) || 0})} className="w-full border p-1 rounded text-xs" />
                    </div>
                    <div>
                        <label className="text-xs text-gray-500">161-400 kVA</label>
                        <input type="number" value={params.poleFee3} onChange={(e) => setParams({...params, poleFee3: parseFloat(e.target.value) || 0})} className="w-full border p-1 rounded text-xs" />
                    </div>
                 </div>
              </div>
            </div>
          </div>
        </div>
      )}

      {/* Main Content */}
      <div className="container mx-auto px-6 py-8">
        
        {/* Tabs */}
        <div className="flex space-x-2 bg-gray-200 p-1 rounded-xl w-fit mb-6">
          <button 
            onClick={() => setActiveTab('manual')}
            className={`px-6 py-2 rounded-lg text-sm font-medium transition flex items-center ${activeTab === 'manual' ? 'bg-white shadow text-blue-700' : 'text-gray-600 hover:text-gray-900'}`}
          >
            <UserPlus className="w-4 h-4 mr-2"/>
            Teklif Bilgileri
          </button>
          <button 
            onClick={() => setActiveTab('proposal')}
            disabled={!selectedCompany}
            className={`px-6 py-2 rounded-lg text-sm font-medium transition flex items-center ${activeTab === 'proposal' ? 'bg-white shadow text-blue-700' : 'text-gray-400 cursor-not-allowed'}`}
          >
            Teklif Ã–nizleme
            {selectedCompany && <span className="ml-2 text-xs bg-blue-100 px-2 py-0.5 rounded-full text-blue-700">{selectedCompany.name.substring(0, 15)}...</span>}
          </button>
        </div>

        {/* Tab Content: Manuel GiriÅŸ */}
        {activeTab === 'manual' && (
           <div className="max-w-2xl mx-auto bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
             <div className="bg-blue-900 px-6 py-4 border-b border-blue-800">
                <h2 className="text-lg font-bold text-white flex items-center">
                    <UserPlus className="mr-2 h-5 w-5"/>
                    Teklif Bilgileri GiriÅŸi
                </h2>
                <p className="text-blue-200 text-xs mt-1">Firma bilgilerini ve EMO parametrelerini girerek teklif hesaplayÄ±n.</p>
             </div>
             
             <form onSubmit={handleManualSubmit} className="p-8 space-y-6">
                
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div className="col-span-2">
                        <label className="block text-sm font-semibold text-gray-700 mb-2">Firma UnvanÄ±</label>
                        <input 
                            required
                            type="text" 
                            placeholder="Ã–rn: ABC EndÃ¼stri San. ve Tic. A.Åž."
                            value={manualForm.name}
                            onChange={(e) => setManualForm({...manualForm, name: e.target.value})}
                            className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition"
                        />
                    </div>

                    <div className="col-span-2">
                        <label className="block text-sm font-semibold text-gray-700 mb-2">Yetkili AdÄ± SoyadÄ±</label>
                        <input 
                            required
                            type="text" 
                            placeholder="Ã–rn: Ahmet YÄ±lmaz"
                            value={manualForm.contactName}
                            onChange={(e) => setManualForm({...manualForm, contactName: e.target.value})}
                            className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition bg-blue-50"
                        />
                        <p className="text-xs text-gray-500 mt-1">Teklif mektubunda "SayÄ±n [Ad Soyad] Yetkilisi" ÅŸeklinde kullanÄ±lacaktÄ±r.</p>
                    </div>

                    <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-2">SektÃ¶r</label>
                        <input 
                            required
                            type="text" 
                            placeholder="Ã–rn: Tekstil, GÄ±da"
                            value={manualForm.sector}
                            onChange={(e) => setManualForm({...manualForm, sector: e.target.value})}
                            className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition"
                        />
                    </div>

                    <div>
                         <label className="block text-sm font-semibold text-gray-700 mb-2">Trafo Merkezi Tipi</label>
                         <select 
                            value={manualForm.type}
                            onChange={(e) => setManualForm({...manualForm, type: e.target.value})}
                            className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition"
                         >
                             <option value="bina">Bina Tipi (Sanayi Tesisleri)</option>
                             <option value="direk">Direk Tipi</option>
                         </select>
                         <p className="text-xs text-gray-500 mt-1">Not: 400 kVA altÄ± bina tipi merkezler, direk tipi olarak da deÄŸerlendirilebilir.</p>
                    </div>

                    <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-2">Toplam Kurulu GÃ¼Ã§ (kVA)</label>
                        <div className="relative">
                            <input 
                                required
                                type="text" 
                                placeholder="Ã–rn: 1600 veya 1000+630"
                                value={manualForm.powerStr}
                                onChange={(e) => setManualForm({...manualForm, powerStr: e.target.value})}
                                className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition font-mono"
                            />
                            <Zap className="absolute right-3 top-3.5 h-5 w-5 text-gray-400" />
                        </div>
                        <p className="text-xs text-gray-500 mt-1">Birden fazla trafo iÃ§in '+' ile ayÄ±rabilirsiniz.</p>
                    </div>

                     {/* Yeni Eklenen Alan: BÃ¶lge/Åžehir SeÃ§imi */}
                    <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-2 flex items-center">
                            <MapPin className="w-4 h-4 mr-1 text-blue-600"/>
                            BÃ¶lge/Åžehir (KatsayÄ±)
                        </label>
                        <div className="relative">
                            <select 
                                value={manualForm.region}
                                onChange={handleRegionChange}
                                className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition appearance-none bg-white"
                            >
                                {REGION_LIST.map((r, index) => (
                                    <option key={index} value={r.name}>
                                        {r.name} (x{r.coeff.toFixed(2)})
                                    </option>
                                ))}
                            </select>
                            <div className="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
                                <svg className="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 9l-7 7-7-7"></path></svg>
                            </div>
                        </div>
                        <p className="text-xs text-green-600 mt-1 font-semibold">
                            SeÃ§ili KatsayÄ±: {manualForm.regionCoeff.toFixed(2)}
                        </p>
                    </div>

                    {/* Yeni Eklenen Alan: Ä°skonto OranÄ± */}
                    <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-2 flex items-center">
                            <Percent className="w-4 h-4 mr-1 text-blue-600"/>
                            Ä°skonto OranÄ± (%)
                        </label>
                        <input 
                            type="number" 
                            min="0"
                            max="100"
                            value={manualForm.customDiscount}
                            onChange={(e) => setManualForm({...manualForm, customDiscount: parseFloat(e.target.value) || 0})}
                            className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition font-bold text-blue-800"
                        />
                         <p className="text-xs text-gray-500 mt-1">VarsayÄ±lan: %{params.discountRate}</p>
                    </div>
                </div>

                <div className="pt-4 border-t border-gray-100 flex items-center justify-between">
                    <div className="text-sm text-gray-500">
                        <span className="font-bold text-blue-900">Not:</span> EMO {params.year} tarifeleri, {manualForm.region} katsayÄ±sÄ± ve %{manualForm.customDiscount} iskonto uygulanacaktÄ±r.
                    </div>
                    <button 
                        type="submit"
                        className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg shadow-lg transform active:scale-95 transition flex items-center"
                    >
                        <Calculator className="mr-2 h-5 w-5"/>
                        Hesapla ve Teklif OluÅŸtur
                    </button>
                </div>

             </form>
           </div>
        )}

        {/* Proposal View */}
        {activeTab === 'proposal' && selectedCompany && (
          <div className="flex gap-6 flex-col lg:flex-row">
            
            {/* LLM Output Panel - Left Side */}
            <div className="lg:w-1/3 space-y-4 print-hide">
              <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                <h3 className="font-bold text-gray-800 mb-4 flex items-center">
                  <Lightbulb className="h-5 w-5 mr-2 text-yellow-500" />
                  Gemini Destekli Teklif AraÃ§larÄ±
                </h3>
                
                {/* PDF/YazdÄ±r Butonu */}
                <button 
                  onClick={handlePrint}
                  className="w-full flex items-center justify-center space-x-2 bg-red-600 hover:bg-red-700 text-white py-3 rounded-lg mb-3 transition"
                >
                  <Printer className="h-5 w-5" />
                  <span>ðŸ“„ PDF Olarak Kaydet</span>
                </button>

                {/* Teklif Ã–zeti OluÅŸturucu */}
                <button 
                  onClick={() => handleGenerateSummary(selectedCompany)}
                  disabled={llmLoading && llmFeature === 'summary'}
                  className="w-full flex items-center justify-center space-x-2 bg-green-500 hover:bg-green-600 text-white py-3 rounded-lg mb-3 transition disabled:bg-gray-400 disabled:cursor-not-allowed"
                >
                  <Mail className="h-5 w-5" />
                  <span>âœ¨ Teklif Ã–zeti OluÅŸtur</span>
                </button>

                {/* RekabetÃ§i Analiz */}
                <button 
                  onClick={() => handleGenerateAnalysis(selectedCompany)}
                  disabled={llmLoading && llmFeature === 'analysis'}
                  className="w-full flex items-center justify-center space-x-2 bg-purple-600 hover:bg-purple-700 text-white py-3 rounded-lg mb-3 transition disabled:bg-gray-400 disabled:cursor-not-allowed"
                >
                  <TrendingDown className="h-5 w-5" />
                  <span>âœ¨ Rakip Analizi Ekle</span>
                </button>
                
                {/* HÄ±zlÄ± DÃ¼zenleme */}
                <div className="bg-blue-50 p-4 rounded-xl border border-blue-100 mt-4">
                    <h3 className="font-bold text-blue-900 mb-2">HÄ±zlÄ± DÃ¼zenleme</h3>
                    <p className="text-xs text-blue-600 mb-4">Bu firma iÃ§in teklifi revize edin.</p>
                    
                    <div className="mb-3">
                    <label className="text-xs font-bold text-blue-800 uppercase">Ã–zel Ä°skonto (%)</label>
                    <input 
                        type="number" 
                        value={params.discountRate} 
                        onChange={(e) => setParams({...params, discountRate: parseFloat(e.target.value) || 0})}
                        className="w-full mt-1 p-2 border border-blue-200 rounded text-sm"
                    />
                    </div>
                </div>
              </div>

              {/* LLM Output Display */}
              <LLMOutputDisplay 
                output={llmOutput} 
                loading={llmLoading} 
                feature={llmFeature}
                onRegenerate={() => {
                    if(llmFeature === 'summary') handleGenerateSummary(selectedCompany);
                    if(llmFeature === 'analysis') handleGenerateAnalysis(selectedCompany);
                }}
              />
            </div>
            

            {/* Proposal Preview (A4 Paper Style) - Right Side */}
            <div className="lg:w-2/3 bg-gray-200 p-8 rounded-xl overflow-auto lg:h-[calc(100vh-200px)] flex-grow print:bg-white print:p-0">
              
              {/* A4 Paper Structure */}
              <div className="bg-white max-w-[210mm] mx-auto min-h-[297mm] p-[20mm] shadow-2xl relative text-[11pt] leading-relaxed text-gray-800 flex flex-col justify-between print-container print:shadow-none print:max-w-full">
                <div>
                    {/* Header */}
                    <div className="flex justify-between items-start mb-8 border-b-2 border-gray-800 pb-4">
                        {/* Top Left Logo */}
                        <div className="w-1/3">
                            <img src="/logo.png" alt="KOBÄ°NERJÄ° LOGO" className="h-16 object-contain" />
                        </div>
                        <div className="text-right">
                            <h1 className="text-xl font-bold text-blue-900 uppercase">FÄ°YAT TEKLÄ°FÄ°</h1>
                            <p className="text-sm text-gray-500 mt-1">Ref: {params.year}-YG-{selectedCompany.id ? selectedCompany.id.toString().padStart(3, '0') : 'MANUEL'}</p>
                            <p className="font-bold text-gray-800">{new Date().toLocaleDateString('tr-TR')}</p>
                        </div>
                    </div>

                    {/* Body Content */}
                    <p className="mb-4">
                      <strong>SayÄ±n {selectedCompany.contactName ? `${selectedCompany.contactName} - ` : ''}{selectedCompany.name} Yetkilisi,</strong>
                    </p>
                    <p className="mb-4 text-justify">
                      Tesisinize yÃ¶nelik <strong>YG Ä°ÅŸletme SorumluluÄŸu</strong> hizmeti fiyat teklifi, talep ettiÄŸiniz trafo kurulu gÃ¼cÃ¼ ve 
                      TMMOB Elektrik MÃ¼hendisleri OdasÄ±'nÄ±n (EMO) {params.year} yÄ±lÄ± Ãœcret TanÄ±mlarÄ± (KISIM III) esas alÄ±narak, 
                      rekabetÃ§i piyasa koÅŸullarÄ± doÄŸrultusunda Ã¶nceki tekliflerimizde uyguladÄ±ÄŸÄ±mÄ±z indirim oranÄ±yla aÅŸaÄŸÄ±da sunulmuÅŸtur.
                    </p>

                    <h3 className="text-lg font-bold text-blue-900 mt-6 mb-3 border-l-4 border-blue-500 pl-3">1. Tesis Bilgileri ve Toplam Kurulu GÃ¼Ã§</h3>
                    <p className="mb-2">Tesisinizde bulunan transformatÃ¶rlerin toplam kurulu gÃ¼cÃ¼ (YÃ¼ksek Gerilim Tesisleri) aÅŸaÄŸÄ±daki gibidir:</p>
                    <div className="bg-gray-50 p-4 rounded-lg border border-gray-200 mb-4">
                      <ul className="list-disc list-inside">
                        <li>Trafo GÃ¼Ã§leri DaÄŸÄ±lÄ±mÄ±: <strong>{selectedCompany.powerStr} kVA</strong></li>
                        <li>Toplam Kurulu GÃ¼Ã§: <strong>{selectedCompany.totalKVA} kVA ({selectedCompany.totalKVA / 1000} MVA)</strong></li>
                        <li>Tesis Tipi: <strong>{selectedCompany.type === 'direk' ? 'Direk Tipi Trafo Merkezi' : 'Bina Tipi Trafo Merkezi'}</strong></li>
                        <li>SektÃ¶r: <strong>{selectedCompany.sector}</strong></li>
                      </ul>
                    </div>

                    <h3 className="text-lg font-bold text-blue-900 mt-6 mb-3 border-l-4 border-blue-500 pl-3">2. EMO {params.year} YÄ±lÄ± AylÄ±k Asgari Ãœcret HesaplamasÄ±</h3>
                    <p className="mb-2">EMO {params.year} YÄ±lÄ± Ãœcret TanÄ±mlarÄ±'nda (KÄ±sÄ±m III), bina ve direk tipi trafo merkezleri iÃ§in aylÄ±k iÅŸletme sorumluluÄŸu bedelleri kapasiteye gÃ¶re belirlenmektedir.</p>
                    
                    <table className="w-full text-sm border-collapse border border-gray-300 mb-4">
                      <thead className="bg-gray-100">
                        <tr>
                          <th className="border border-gray-300 p-2 text-left">Kapasite AralÄ±ÄŸÄ±</th>
                          <th className="border border-gray-300 p-2 text-left">Birim Fiyat</th>
                          <th className="border border-gray-300 p-2 text-right">Tutar (TL)</th>
                        </tr>
                      </thead>
                      <tbody>
                        {/* BÄ°NA TÄ°PÄ° GÃ–STERÄ°MÄ° */}
                        {selectedCompany.type !== 'direk' && selectedCompany.totalKVA >= 400 && (
                          <>
                            <tr>
                              <td className="border border-gray-300 p-2">Ä°lk 400 kVA (Sabit)</td>
                              <td className="border border-gray-300 p-2">{formatCurrency(params.baseFee)} TL</td>
                              <td className="border border-gray-300 p-2 text-right">{formatCurrency(params.baseFee)} TL</td>
                            </tr>
                            {selectedCompany.totalKVA > 400 && selectedCompany.totalKVA <= 5000 && (
                              <tr>
                                <td className="border border-gray-300 p-2">401 - {selectedCompany.totalKVA} kVA ArasÄ± (Artan)</td>
                                <td className="border border-gray-300 p-2">{params.rate1} TL/kVA</td>
                                <td className="border border-gray-300 p-2 text-right">
                                  {formatCurrency((selectedCompany.totalKVA - 400) * params.rate1)} TL
                                </td>
                              </tr>
                            )}
                            {selectedCompany.totalKVA > 5000 && (
                              <>
                              <tr>
                                <td className="border border-gray-300 p-2">401 - 5000 kVA ArasÄ± (Artan)</td>
                                <td className="border border-gray-300 p-2">{params.rate1} TL/kVA</td>
                                <td className="border border-gray-300 p-2 text-right">
                                  {formatCurrency(4600 * params.rate1)} TL
                                </td>
                              </tr>
                              <tr>
                                <td className="border border-gray-300 p-2">5000 kVA Ãœzeri (Artan)</td>
                                <td className="border border-gray-300 p-2">{params.rate2} TL/kVA</td>
                                <td className="border border-gray-300 p-2 text-right">
                                  {formatCurrency((selectedCompany.totalKVA - 5000) * params.rate2)} TL
                                </td>
                              </tr>
                              </>
                            )}
                          </>
                        )}

                        {/* DÄ°REK TÄ°PÄ° VEYA <400 BÄ°NA GÃ–STERÄ°MÄ° */}
                        {(selectedCompany.type === 'direk' || (selectedCompany.type === 'bina' && selectedCompany.totalKVA < 400)) && (
                          <tr>
                              <td className="border border-gray-300 p-2">
                                  {selectedCompany.totalKVA <= 50 ? '0-50 kVA' : 
                                  selectedCompany.totalKVA <= 160 ? '51-160 kVA' : '161-400 kVA'} Sabit Bedel
                              </td>
                              <td className="border border-gray-300 p-2">Sabit</td>
                              <td className="border border-gray-300 p-2 text-right">
                                  {formatCurrency(selectedCompany.nominalFee / (selectedCompany.regionCoeff || 1))} TL
                              </td>
                          </tr>
                        )}
                        
                        {(selectedCompany.regionCoeff || params.regionCoeff) !== 1 && (
                          <tr className="bg-yellow-50">
                            <td className="border border-gray-300 p-2" colSpan="2">BÃ¶lgesel Azaltma KatsayÄ±sÄ± (x {(selectedCompany.regionCoeff || params.regionCoeff)})</td>
                            <td className="border border-gray-300 p-2 text-right text-yellow-700 font-bold">
                                {(selectedCompany.regionCoeff || params.regionCoeff) < 1 ? '-' : '+'}{formatCurrency(Math.abs(selectedCompany.nominalFee - (selectedCompany.nominalFee / (selectedCompany.regionCoeff || params.regionCoeff))))} TL
                            </td>
                          </tr>
                        )}

                        <tr className="bg-blue-50 font-bold">
                          <td className="border border-gray-300 p-2" colSpan="2">EMO {params.year} TOPLAM NOMÄ°NAL TARÄ°FE (KDV HariÃ§)</td>
                          <td className="border border-gray-300 p-2 text-right">{formatCurrency(selectedCompany.nominalFee)} TL</td>
                        </tr>
                      </tbody>
                    </table>

                    <h3 className="text-lg font-bold text-blue-900 mt-6 mb-3 border-l-4 border-blue-500 pl-3">3. Uygulanan Ä°skonto ve Nihai Teklif</h3>
                    <p className="mb-4">Piyasa koÅŸullarÄ±na uyum saÄŸlamak amacÄ±yla, iÅŸletmenize Ã¶zel <strong>%{selectedCompany.appliedDiscountRate || params.discountRate}</strong> iskonto uygulanmÄ±ÅŸtÄ±r.</p>
                    
                    <div className="bg-blue-900 text-white rounded-lg p-6 shadow-lg mb-8">
                      <div className="flex justify-between items-center mb-2 opacity-80">
                        <span>EMO Nominal Tarife:</span>
                        <span>{formatCurrency(selectedCompany.nominalFee)}</span>
                      </div>
                      <div className="flex justify-between items-center mb-4 text-red-300">
                        <span>Ä°skonto TutarÄ± (%{selectedCompany.appliedDiscountRate || params.discountRate}):</span>
                        <span>- {formatCurrency(selectedCompany.discountAmount)}</span>
                      </div>
                      <div className="border-t border-blue-700 pt-4 flex justify-between items-center text-2xl font-bold">
                        <span>AYLIK TEKLÄ°F FÄ°YATI:</span>
                        <span>{formatCurrency(selectedCompany.offerPrice)} + KDV</span>
                      </div>
                    </div>

                    <div className="text-sm text-gray-600 border-t pt-4 mt-8">
                      <h4 className="font-bold mb-2">AÃ§Ä±klamalar:</h4>
                      <ul className="list-disc list-inside space-y-1">
                        <li>1. Bu teklif {params.year} yÄ±lÄ± boyunca geÃ§erli olmak Ã¼zere aylÄ±k periyotlarla hazÄ±rlanmÄ±ÅŸtÄ±r.</li>
                        <li>2. Ä°ÅŸletme sorumluluÄŸu hizmetinin SMM tarafÄ±ndan Ã¼stlenilmesi halinde YG tesisi en az ayda bir kez denetlenmelidir.</li>
                        <li>3. Enerji tÃ¼ketiminin izlenmesi ve kompanzasyon tesisinin saÄŸlÄ±klÄ± Ã§alÄ±ÅŸÄ±p Ã§alÄ±ÅŸmadÄ±ÄŸÄ±nÄ±n denetlenmesi bu hizmetin SORUMLULUK KAPSAMINDADIR.</li>
                        <li>4. EMO tarafÄ±ndan hazÄ±rlanan Elektrik YÃ¼ksek Gerilim Tesisleri Ä°ÅŸletme SorumluluÄŸu YÃ¶netmeliÄŸi bu sÃ¶zleÅŸmenin ayrÄ±lmaz bir parÃ§asÄ±dÄ±r. YG Ä°ÅŸletme SorumluluÄŸunu Ã¼stlenecek mÃ¼hendisin EMO tarafÄ±ndan verilen YGTÄ°S belgesine sahip olmasÄ± gerekir.</li>
                        <li>5. Ä°ÅŸveren olarak sizin yÃ¼kÃ¼mlÃ¼lÃ¼ÄŸÃ¼nÃ¼z, Ä°ÅŸletme Sorumlusunun gÃ¶revlerini yerine getirebilmesi iÃ§in gerekli imalatlarÄ±/hizmetleri saÄŸlamak, talep edilen gÃ¼venlik malzemelerini almak ve uyarÄ±larÄ±na riayet etmektir.</li>
                      </ul>
                    </div>
                </div>

                {/* Footer */}
                <div className="mt-8 border-t pt-4">
                    <div className="flex justify-between items-end">
                        {/* Bottom Left Logo/Antet */}
                        <div className="w-2/3">
                            <img src="/antet.png" alt="KOBÄ°NERJÄ° ANTET" className="h-24 object-contain" />
                        </div>
                        <div className="w-1/3 text-right text-xs text-gray-500">
                            <p className="font-bold">KOBÄ°NERJÄ° MÃœHENDÄ°SLÄ°K VE<br/>ENERJÄ° VERÄ°MLÄ°LÄ°ÄžÄ° DANIÅžMANLIK A.Åž.</p>
                        </div>
                    </div>
                </div>
              </div>
            </div>

          </div>
        )}

      </div>
    </div>
  );
};

export default App;
